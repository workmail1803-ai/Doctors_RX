<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Write Prescription</title>
  <link rel="stylesheet" href="newstyle.css">
</head>
<body>
  <div class="app-container">
    <!-- Sidebar (kept as-is) -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <a href="newindex.html" class="sidebar-logo">
          <div class="logo-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 2l2.5 5 5 .7-3.7 3.6.9 5-4.7-2.5L7.3 16l.9-5L4.5 7.7 9.5 7z"/>
            </svg>
          </div>
          <div class="logo-text">
            <h2>Rx Portal</h2>
            <p>Medical System</p>
          </div>
        </a>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Main</div>
          <a href="newindex.html" class="nav-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            </svg>
            Home
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Actions</div>
          <a href="newwrite-prescription.html" class="nav-link active">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/>
            </svg>
            Write Prescription
          </a>
          <a href="newview-prescription.html" class="nav-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <path d="M14 2v6h6"/>
            </svg>
            View Prescriptions
          </a>
          <a href="newview-visits.html" class="nav-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2"/>
              <path d="M16 2v4M8 2v4M3 10h18"/>
            </svg>
            View Visits
          </a>
        </div>
      </nav>

      <div class="sidebar-footer">
        © 2024 Medical Portal
      </div>
    </aside>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="menuToggle" aria-label="Toggle menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 12h18M3 6h18M3 18h18"/>
      </svg>
    </button>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Main Content -->
    <main class="main-content">
      <div class="content-wrapper">
        <div class="page-header">
          <h1>Patient Prescription</h1>
          <p>Create detailed prescription for patient care</p>
        </div>

        <div class="toolbar">
          <div class="spacer"></div>
          <div class="dropdown">
            <button type="button" class="btn btn--ghost" id="btn-sections">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 8h16M4 12h16M4 16h16"/>
              </svg>
              Sections ▾
            </button>
            <div class="menu" id="menu-sections" role="menu" aria-label="Select sections to include"></div>
          </div>
          <button class="btn btn--ghost" id="btn-portal">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            </svg>
            Portal
          </button>
          <button type="button" class="btn" id="btn-save">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V7l4-4h11l3 3v13a2 2 0 0 1-2 2Z"/>
            </svg>
            Save
          </button>
          <button type="button" class="btn btn--primary" id="btn-save-print">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 9V3h12v6"/>
              <rect x="6" y="13" width="12" height="8" rx="2"/>
            </svg>
            Save &amp; Print
          </button>
          <button type="button" class="btn btn--ghost" id="btn-clear">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18M8 6v12M16 6v12"/>
            </svg>
            Clear
          </button>
        </div>

        <div class="card">
          <form id="prescriptionForm" onsubmit="return false;">

            <!-- Patient Details (always visible) -->
            <div class="section-title">Patient Details</div>
            <div class="grid">
              <div class="col-6">
                <label for="patientName" style="display:flex;align-items:center;justify-content:space-between;gap:10px">
                  <span>Patient Name</span>
                  <button type="button" class="btn mini" id="btn-peek" title="Peek past prescriptions">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8Z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                    Peek
                  </button>
                </label>
                <input type="text" id="patientName" placeholder="e.g., Jane Doe" autocomplete="name" required>
              </div>
              <div class="col-3">
                <label for="age">Age</label>
                <input type="number" id="age" inputmode="numeric" min="0" max="150" placeholder="65">
              </div>
              <div class="col-3">
                <label for="sex">Sex</label>
                <select id="sex" required>
                  <option value="">Select</option>
                  <option value="Female">Female</option>
                  <option value="Male">Male</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="col-3">
                <label for="date">Date</label>
                <input type="date" id="date">
              </div>
              <div class="col-3">
                <label for="followUp">Follow-Up Days</label>
                <select id="followUp" onchange="customFollowUp.value = ''">
                  <option value="">Select</option>
                  <option value="5">৫ দিন পরে আসবেন</option>
                  <option value="7">৭ দিন পরে আসবেন</option>
                  <option value="12">২ সপ্তাহ পরে আসবেন</option>
                  <option value="28">৪ সপ্তাহ পরে আসবেন</option>
                  <option value="90">৩ মাস পরে আসবেন</option>
                  <option value="365">১ বছর পরে আসবেন</option>
                </select>
              </div>
              <div class="col-3">
                <label for="customFollowUp">Or enter custom</label>
                <input type="number" id="customFollowUp" placeholder="e.g., 6" oninput="followUp.value = ''" min="1" max="60">
              </div>
            </div>

            <!-- Section Switcher -->
            <div class="section-switcher" role="tablist" aria-label="Prescription sections">
              <button type="button" class="seg-btn" data-target="#panel-diseases">Diseases</button>
              <button type="button" class="seg-btn" data-target="#panel-exam">Examination</button>
              <button type="button" class="seg-btn" data-target="#panel-treatment">Treatment</button>
              <button type="button" class="seg-btn" data-target="#panel-tests">Tests</button>
              <button type="button" class="seg-btn" data-target="#panel-advice">Advice</button>
              <button type="button" class="seg-btn" data-target="#panel-notes">Notes</button>
              <button type="button" class="seg-btn" data-target="#panel-histories">Histories</button>
            </div>

            <!-- PANELS (hidden by default; show when button tapped) -->

            <!-- Diseases -->
            <section id="panel-diseases" class="panel" hidden>
              <div class="section-title">Diseases &amp; Duration</div>
              <div class="grid">
                <div class="col-12">
                  <label style="display:flex;align-items:center;justify-content:space-between;gap:10px">
                    <span>Add Diseases</span>
                    <button type="button" class="btn mini" id="btn-add-disease">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"/>
                      </svg>
                      Add Disease
                    </button>
                  </label>
                  <div id="diseases-container"></div>
                  <div id="suggest" class="suggest" aria-live="polite">
                    <div class="head">
                      <span>Suggestions from your records</span>
                      <button type="button" class="btn mini" onclick="hideSuggestions()">Hide</button>
                    </div>
                    <div class="chips" id="suggest-chips"></div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Examination / Provisional Dx -->
            <section id="panel-exam" class="panel" hidden>
              <div class="section-title">Provisional Diagnosis</div>
              <label for="examinationSelect">Add Examination Findings</label>
              <select id="examinationSelect" class="input">
                <option value="">Select...</option>
                <option value="Anemia">Anemia</option>
                <option value="Jaundice">Jaundice</option>
                <option value="Lymph Node">Lymph Node</option>
                <option value="Heart">Heart</option>
                <option value="Lungs">Lungs</option>
                <option value="Liver">Liver</option>
                <option value="Spleen">Spleen</option>
                <option value="Abdomen">Abdomen</option>
                <option value="Skin">Skin</option>
                <option value="Eyes">Eyes</option>
                <option value="Hydration">Hydration</option>
                <option value="Oedema">Oedema</option>
                <option value="Temperature">Temperature</option>
                <option value="Respiratory Rate">Respiratory Rate</option>
                <option value="Pallor">Pallor</option>
                <option value="Cyanosis">Cyanosis</option>
                <option value="Clubbing">Clubbing</option>
                <option value="BP">Blood Pressure (BP)</option>
                <option value="Weight">Weight</option>
              </select>
              <div id="provisionalDiagnosisContainer"></div>
            </section>

            <!-- Treatment / Medicines -->
            <section id="panel-treatment" class="panel" hidden>
              <div class="section-title">Treatment</div>
              <div class="toolbar">
                <div class="spacer"></div>
                <button type="button" class="btn" id="btn-add-med">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"/>
                  </svg>
                  Add Medicine
                </button>
              </div>
              <table id="meds-table">
                <thead>
                  <tr>
                    <th>Medicine (Brand - Form)</th>
                    <th>Dosage</th>
                    <th>Frequency</th>
                    <th style="width: 150px;">Duration</th>
                    <th width="40"></th>
                  </tr>
                </thead>
                <tbody id="meds-tbody"></tbody>
              </table>
            </section>

            <!-- Tests -->
            <section id="panel-tests" class="panel" hidden>
              <div class="section-title">Investigations</div>
              <div class="toolbar">
                <div class="spacer"></div>
                <button type="button" class="btn" id="btn-add-test">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"/>
                  </svg>
                  Add Test
                </button>
              </div>
              <table id="tests-table">
                <thead>
                  <tr>
                    <th>Test Name</th>
                    <th>Notes</th>
                    <th width="40"></th>
                  </tr>
                </thead>
                <tbody id="tests-tbody"></tbody>
              </table>
            </section>

            <!-- Advice -->
            <section id="panel-advice" class="panel" hidden>
              <div class="section-title">উপদেশ</div>
              <div class="grid">
                <div class="col-12">
                  <label style="display:flex;align-items:center;justify-content:space-between;gap:10px">
                    <span>Add Advice Boxes</span>
                    <button type="button" class="btn mini" id="btn-add-advice">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"/>
                      </svg>
                      Add Box
                    </button>
                  </label>
                  <div id="advice-container"></div>
                </div>
              </div>
            </section>

            <!-- Notes -->
            <section id="panel-notes" class="panel" hidden>
              <div class="section-title">Notes</div>
              <div class="grid">
                <div class="col-12">
                  <label for="notes">Provisional Diagnosis</label>
                  <textarea id="notes" placeholder=""></textarea>
                </div>
              </div>
            </section>

            <!-- Histories -->
            <section id="panel-histories" class="panel" hidden>
              <div class="section-title">Histories (Optional)</div>
              <div class="opt-grid">
                <div class="opt-col-6">
                  <div class="opt-card" id="opt-pastIllness">
                    <div class="opt-head"><span class="opt-title">Past Illness</span></div>
                    <textarea id="pastIllness" placeholder="Free text…"></textarea>
                  </div>
                </div>
                <div class="opt-col-6">
                  <div class="opt-card" id="opt-birthHistory">
                    <div class="opt-head"><span class="opt-title">Birth History</span></div>
                    <textarea id="birthHistory" placeholder="Free text…"></textarea>
                  </div>
                </div>
                <div class="opt-col-6">
                  <div class="opt-card" id="opt-feedingHistory">
                    <div class="opt-head"><span class="opt-title">Feeding History</span></div>
                    <textarea id="feedingHistory" placeholder="Free text…"></textarea>
                  </div>
                </div>
                <div class="opt-col-6">
                  <div class="opt-card" id="opt-developmentHistory">
                    <div class="opt-head"><span class="opt-title">Development History</span></div>
                    <textarea id="developmentHistory" placeholder="Free text…"></textarea>
                  </div>
                </div>
                <div class="opt-col-6">
                  <div class="opt-card" id="opt-treatmentHistory">
                    <div class="opt-head"><span class="opt-title">Treatment History</span></div>
                    <textarea id="treatmentHistory" placeholder="Free text…"></textarea>
                  </div>
                </div>
                <div class="opt-col-6">
                  <div class="opt-card" id="opt-familyHistory">
                    <div class="opt-head"><span class="opt-title">Family History</span></div>
                    <textarea id="familyHistory" placeholder="Free text…"></textarea>
                  </div>
                </div>
              </div>
            </section>

          </form>
        </div>
      </div>
    </main>
  </div>

  <!-- Peek Popover -->
  <div class="peek-pop" id="peek-pop">
    <div class="peek-head">
      <span>Past Prescriptions</span>
      <button type="button" class="btn mini" onclick="hidePeek()">×</button>
    </div>
    <div class="peek-list" id="peek-list"></div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <div class="bubble" id="toast-text">Saved!</div>
  </div>

  <!-- JavaScript -->
  <script src="meds-data.js"></script>
  <script>window.medsData = window.medsData || window.MEDS_DATA || [];</script>
  <script src="script.js"></script>
  <script>
    // Mobile menu toggle
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const mobileOverlay = document.getElementById('mobileOverlay');
    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('active');
      mobileOverlay.classList.toggle('active');
    });
    mobileOverlay.addEventListener('click', () => {
      sidebar.classList.remove('active');
      mobileOverlay.classList.remove('active');
    });

    // Go to portal
    document.getElementById('btn-portal')?.addEventListener('click', () => {
      location.href = 'newindex.html';
    });

    // Panel toggling — keep everything hidden until a button is tapped
    const panels = Array.from(document.querySelectorAll('.panel'));
    const segButtons = Array.from(document.querySelectorAll('.section-switcher .seg-btn'));
    function showPanelBySelector(sel) {
      const target = document.querySelector(sel);
      if (!target) return;
      panels.forEach(p => p.hidden = true);
      target.hidden = false;
      segButtons.forEach(b => b.classList.toggle('active', b.dataset.target === sel));
    }
    segButtons.forEach(btn => {
      btn.addEventListener('click', () => showPanelBySelector(btn.dataset.target));
    });
    // NOTE: none opened by default per your request.

  </script>
</body>
</html>
